<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura no Labirinto do Conhecimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.8em;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px rgba(52, 152, 219, 0.7); }
            100% { text-shadow: 0 0 20px rgba(231, 76, 60, 0.7), 0 0 30px rgba(231, 76, 60, 0.5); }
        }
        
        .subtitle {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #bdc3c7;
        }
        
        .game-container {
            position: relative;
            margin: 0 auto;
            width: 800px;
            height: 600px;
            border: 4px solid #34495e;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            background: #2c3e50;
        }
        
        canvas {
            display: block;
            background: #34495e;
        }
        
        .panel {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(44, 62, 80, 0.7);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px 15px;
            background: rgba(52, 73, 94, 0.8);
            border-radius: 8px;
            min-width: 100px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #bdc3c7;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
        }
        
        .jump-info {
            background: rgba(231, 76, 60, 0.2) !important;
            border: 1px dashed #e74c3c;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4);
            background: linear-gradient(to bottom, #2980b9, #3498db);
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(to bottom, #c0392b, #e74c3c);
        }
        
        .btn-jump {
            background: linear-gradient(to bottom, #9b59b6, #8e44ad);
        }
        
        .btn-jump:hover {
            background: linear-gradient(to bottom, #8e44ad, #9b59b6);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2c3e50, #1a2530);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 30px rgba(52, 152, 219, 0.5);
            text-align: left;
        }
        
        .modal h2 {
            color: #3498db;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }
        
        .modal ul {
            list-style-type: none;
            padding: 0;
            margin-bottom: 25px;
        }
        
        .modal li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
        }
        
        .modal li:before {
            content: "•";
            color: #e74c3c;
            font-weight: bold;
            position: absolute;
            left: 10px;
        }
        
        .requirements {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(44, 62, 80, 0.7);
            border-radius: 10px;
            text-align: left;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .requirements h2 {
            color: #3498db;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .requirements h3 {
            color: #e74c3c;
            margin: 15px 0 10px;
        }
        
        .requirements p {
            margin-bottom: 10px;
            padding-left: 15px;
        }
        
        footer {
            margin-top: 30px;
            color: #7f8c8d;
            text-align: center;
            font-size: 0.9em;
        }
        
        /* Responsividade */
        @media (max-width: 850px) {
            .game-container {
                width: 100%;
                height: 500px;
            }
            
            canvas {
                width: 100%;
                height: 500px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .panel {
                flex-direction: column;
                gap: 15px;
            }
            
            .stats {
                justify-content: space-around;
            }
        }
        
        @media (max-width: 600px) {
            .game-container {
                height: 400px;
            }
            
            canvas {
                height: 400px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .stat-item {
                min-width: 80px;
                padding: 8px 12px;
            }
            
            .stat-value {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Aventura no Labirinto do Conhecimento</h1>
            <p class="subtitle">Colete conhecimentos, resolva desafios e encontre a saída!</p>
        </header>
        
        <div class="panel">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Conhecimentos</div>
                    <div class="stat-value" id="knowledgeCounter">0/5</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Tempo</div>
                    <div class="stat-value" id="timer">00:00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Vidas</div>
                    <div class="stat-value" id="lives">3</div>
                </div>
                <div class="stat-item jump-info">
                    <div class="stat-label">Força do Pulo</div>
                    <div class="stat-value" id="jumpPower">15</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" id="restartBtn">Reiniciar</button>
                <button class="btn" id="pauseBtn">Pausar</button>
                <button class="btn btn-jump" id="increaseJumpBtn">Aumentar Pulo +</button>
                <button class="btn btn-secondary" id="helpBtn">Ajuda</button>
            </div>
        </div>
        
        <div class="game-container">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>
        
        <div class="requirements">
            <h2>Requisitos do Projeto</h2>
            
            <h3>Histórias de Usuário</h3>
            <p><strong>HU1:</strong> Como Jogador, quero coletar itens de conhecimento durante o jogo, para aumentar meu score e desbloquear novas áreas do labirinto.</p>
            <p><strong>HU2:</strong> Como Jogador, quero resolver desafios educativos simples, para testar meus conhecimentos e progredir no jogo.</p>
            <p><strong>HU3:</strong> Como Designer do Jogo, quero ter ferramentas para criar e posicionar obstáculos e desafios, para proporcionar uma experiência de jogo envolvente e educativa.</p>
            
            <h3>Requisitos Não Funcionais</h3>
            <p><strong>RNF1 (Desempenho):</strong> O jogo deve manter uma taxa de quadros constante (pelo menos 30 FPS) em dispositivos móveis com recursos limitados.</p>
            <p><strong>RNF2 (Usabilidade):</strong> Os controles do jogo devem ser intuitivos e responsivos, adaptados para touchscreen em dispositivos móveis.</p>
            <p><strong>RNF3 (Confiabilidade/Segurança):</strong> O jogo deve salvar automaticamente o progresso do jogador a cada fase concluída, prevenindo perda de dados.</p>
        </div>
        
        <footer>
            <p>Desenvolvido por Bugikarol para o Projeto de Software - Aventura no Labirinto do Conhecimento | &copy; 2025</p>
        </footer>
    </div>

    <!-- Modal de Ajuda -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <h2>Como Jogar</h2>
            <ul>
                <li>Use as teclas <strong>W, A, S, D</strong> ou <strong>setas direcionais</strong> para mover o personagem</li>
                <li>Pressione <strong>Espaço</strong> ou <strong>seta para cima</strong> para pular</li>
                <li>Use o botão <strong>Aumentar Pulo</strong> para melhorar sua capacidade de salto (máximo: 3 vezes)</li>
                <li>Colete todos os 5 livros de conhecimento para progredir no labirinto</li>
                <li>Resolva os desafios educativos para desbloquear novas áreas</li>
                <li>Evite os obstáculos vermelhos para não perder vidas</li>
                <li>Encontre a porta de saída após completar todos os objetivos</li>
                <li>Você tem 3 vidas - boa sorte!</li>
            </ul>
            <button class="btn" id="closeHelpBtn">Entendi</button>
        </div>
    </div>

    <!-- Modal de Desafio -->
    <div class="modal" id="challengeModal">
        <div class="modal-content">
            <h2>Desafio do Conhecimento</h2>
            <div id="challengeQuestion"></div>
            <div id="challengeOptions" style="margin: 20px 0;"></div>
            <button class="btn" id="submitAnswerBtn">Responder</button>
        </div>
    </div>

    <script>
        // Classes para organizar o código
        class Player {
            constructor() {
                this.x = 50;
                this.y = 50;
                this.width = 30;
                this.height = 30;
                this.color = '#e74c3c';
                this.speed = 5;
                this.jumpStrength = 15; // Aumentado para 15 (era 12)
                this.yVelocity = 0;
                this.isJumping = false;
                this.facing = 'right';
                this.jumpPowerLevel = 1;
                this.maxJumpPower = 3;
            }

            draw(ctx) {
                // Corpo do jogador
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Detalhes do jogador (olhos)
                ctx.fillStyle = '#fff';
                if (this.facing === 'right') {
                    ctx.fillRect(this.x + 20, this.y + 7, 6, 6);
                } else {
                    ctx.fillRect(this.x + 4, this.y + 7, 6, 6);
                }
                
                // Indicador de poder de pulo
                ctx.fillStyle = '#9b59b6';
                for (let i = 0; i < this.jumpPowerLevel; i++) {
                    ctx.fillRect(this.x + i * 10, this.y - 10, 8, 5);
                }
            }

            update(gravity, canvasHeight) {
                this.yVelocity += gravity;
                this.y += this.yVelocity;

                // Limites da tela
                if (this.y + this.height > canvasHeight) {
                    this.y = canvasHeight - this.height;
                    this.yVelocity = 0;
                    this.isJumping = false;
                }
                
                if (this.y < 0) {
                    this.y = 0;
                    this.yVelocity = 0;
                }
                
                if (this.x < 0) this.x = 0;
                if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
            }
            
            increaseJumpPower() {
                if (this.jumpPowerLevel < this.maxJumpPower) {
                    this.jumpPowerLevel++;
                    this.jumpStrength += 3; // Aumenta a força do pulo
                    return true;
                }
                return false;
            }
            
            getJumpStrength() {
                return this.jumpStrength * (this.jumpPowerLevel / 2);
            }
        }

        class Platform {
            constructor(x, y, width, height, type = 'normal') {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.type = type;
                
                switch(type) {
                    case 'hazard':
                        this.color = '#e74c3c';
                        break;
                    case 'goal':
                        this.color = '#f1c40f';
                        break;
                    case 'challenge':
                        this.color = '#9b59b6';
                        break;
                    case 'jump':
                        this.color = '#3498db';
                        break;
                    default:
                        this.color = '#2ecc71';
                }
            }

            draw(ctx) {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Padrão para plataformas de perigo
                if (this.type === 'hazard') {
                    ctx.fillStyle = '#c0392b';
                    for (let i = 0; i < this.width; i += 10) {
                        ctx.fillRect(this.x + i, this.y + 5, 5, 3);
                    }
                }
                
                // Desenho especial para a meta
                if (this.type === 'goal') {
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2, this.y + this.height/2, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2 - 10, this.y + this.height/2, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2 + 10, this.y + this.height/2, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Desenho especial para desafios
                if (this.type === 'challenge') {
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.fillText("?", this.x + this.width/2 - 3, this.y + this.height/2 + 4);
                }
                
                // Desenho especial para plataformas de pulo
                if (this.type === 'jump') {
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.fillText("↑", this.x + this.width/2 - 3, this.y + this.height/2 + 4);
                }
            }
        }

        class Collectible {
            constructor(x, y, type = 'knowledge') {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.type = type;
                this.collected = false;
                this.animationOffset = 0;
                this.animationDirection = 1;
            }

            draw(ctx) {
                if (this.collected) return;
                
                this.animationOffset += 0.05 * this.animationDirection;
                if (this.animationOffset > 5 || this.animationOffset < 0) {
                    this.animationDirection *= -1;
                }
                
                if (this.type === 'knowledge') {
                    // Desenha um livro de conhecimento
                    ctx.fillStyle = '#3498db';
                    ctx.fillRect(this.x, this.y - this.animationOffset, this.width, this.height);
                    
                    ctx.fillStyle = '#2980b9';
                    ctx.fillRect(this.x + 3, this.y + 3 - this.animationOffset, this.width - 6, this.height - 6);
                    
                    ctx.fillStyle = '#fff';
                    ctx.font = '14px Arial';
                    ctx.fillText("K", this.x + 7, this.y + 15 - this.animationOffset);
                }
            }

            checkCollision(player) {
                if (this.collected) return false;
                
                return (
                    player.x < this.x + this.width &&
                    player.x + player.width > this.x &&
                    player.y < this.y + this.height &&
                    player.y + player.height > this.y
                );
            }
        }

        // Configurações do jogo
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gravity = 0.5;
        let keys = {};
        let gameRunning = true;
        let gamePaused = false;
        let knowledgeCollected = 0;
        let totalKnowledge = 5;
        let playerLives = 3;
        let gameTime = 0;
        let timerInterval;
        let goalReached = false;
        let activeChallenge = null;

        // Elementos da UI
        const knowledgeCounter = document.getElementById('knowledgeCounter');
        const timerElement = document.getElementById('timer');
        const livesElement = document.getElementById('lives');
        const jumpPowerElement = document.getElementById('jumpPower');
        const restartBtn = document.getElementById('restartBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const increaseJumpBtn = document.getElementById('increaseJumpBtn');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeHelpBtn = document.getElementById('closeHelpBtn');
        const challengeModal = document.getElementById('challengeModal');
        const challengeQuestion = document.getElementById('challengeQuestion');
        const challengeOptions = document.getElementById('challengeOptions');
        const submitAnswerBtn = document.getElementById('submitAnswerBtn');

        // Banco de desafios educativos
        const challenges = [
            {
                question: "Qual é a capital do Brasil?",
                options: ["Rio de Janeiro", "Brasília", "São Paulo", "Salvador"],
                answer: 1
            },
            {
                question: "Quantos planetas existem no sistema solar?",
                options: ["7", "8", "9", "10"],
                answer: 1
            },
            {
                question: "Quem escreveu 'Dom Quixote'?",
                options: ["Miguel de Cervantes", "William Shakespeare", "Machado de Assis", "Gabriel García Márquez"],
                answer: 0
            },
            {
                question: "Qual é o maior oceano do mundo?",
                options: ["Atlântico", "Índico", "Ártico", "Pacífico"],
                answer: 3
            },
            {
                question: "Que elemento químico tem o símbolo 'O'?",
                options: ["Ouro", "Oxigênio", "Ósmio", "Osmio"],
                answer: 1
            }
        ];

        // Instância do jogador
        const player = new Player();

        // Plataformas e obstáculos - reorganizadas para melhor jogabilidade
        const platforms = [
            // Plataformas principais
            new Platform(0, 550, 800, 50, 'normal'),
            new Platform(100, 450, 200, 20, 'normal'),
            new Platform(400, 350, 150, 20, 'normal'),
            new Platform(200, 250, 100, 20, 'normal'),
            new Platform(600, 200, 150, 20, 'normal'),
            new Platform(500, 450, 200, 20, 'normal'),
            
            // Plataforma de pulo para ajudar a alcançar áreas mais altas
            new Platform(300, 400, 80, 20, 'jump'),
            
            // Obstáculos perigosos
            new Platform(300, 550, 50, 20, 'hazard'),
            new Platform(550, 550, 70, 20, 'hazard'),
            
            // Plataforma de desafio
            new Platform(650, 450, 100, 20, 'challenge'),
            
            // Plataforma de objetivo (mais acessível)
            new Platform(650, 150, 80, 20, 'goal')
        ];

        // Itens colecionáveis - posicionados para guiar o jogador
        const collectibles = [
            new Collectible(150, 420),
            new Collectible(450, 320),
            new Collectible(230, 220),
            new Collectible(650, 170),
            new Collectible(550, 420)
        ];

        // Inicialização do jogo
        function initGame() {
            gameRunning = true;
            gamePaused = false;
            knowledgeCollected = 0;
            playerLives = 3;
            gameTime = 0;
            goalReached = false;
            activeChallenge = null;
            
            player.x = 50;
            player.y = 50;
            player.yVelocity = 0;
            player.jumpPowerLevel = 1;
            player.jumpStrength = 15;
            
            // Reset coletáveis
            collectibles.forEach(item => item.collected = false);
            
            // Desativa a plataforma de objetivo inicialmente
            platforms[platforms.length - 1].color = '#7f8c8d';
            
            // Atualiza UI
            updateUI();
            
            // Inicia o timer
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!gamePaused && gameRunning) {
                    gameTime++;
                    updateTimer();
                }
            }, 1000);
            
            // Inicia o loop do jogo
            if (!gamePaused) {
                requestAnimationFrame(gameLoop);
            }
        }

        // Loop principal do jogo
        function gameLoop() {
            if (!gameRunning || gamePaused) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenha fundo
            drawBackground();
            
            // Atualiza e desenha plataformas
            platforms.forEach(platform => platform.draw(ctx));
            
            // Atualiza e desenha coletáveis
            collectibles.forEach(item => {
                item.draw(ctx);
                if (item.checkCollision(player) && !item.collected) {
                    item.collected = true;
                    knowledgeCollected++;
                    updateUI();
                    
                    // Ativa a plataforma de objetivo se todos os conhecimentos foram coletados
                    if (knowledgeCollected === totalKnowledge) {
                        platforms[platforms.length - 1].color = '#27ae60';
                    }
                }
            });
            
            // Atualiza e desenha jogador
            handleInput();
            player.update(gravity, canvas.height);
            checkCollisions();
            player.draw(ctx);
            
            // Verifica desafios
            checkChallenge();
            
            // Verifica vitória
            if (knowledgeCollected === totalKnowledge) {
                checkGoal();
            }
            
            // Verifica game over
            if (playerLives <= 0) {
                gameOver();
                return;
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Desenha o fundo com gradiente
        function drawBackground() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, "#2c3e50");
            gradient.addColorStop(1, "#1a2530");
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Estrelas de fundo
            ctx.fillStyle = "#ecf0f1";
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height / 2;
                const size = Math.random() * 2;
                ctx.fillRect(x, y, size, size);
            }
            
            // Desenha dicas visuais para plataformas altas
            ctx.fillStyle = 'rgba(52, 152, 219, 0.3)';
            ctx.beginPath();
            ctx.moveTo(650, 150);
            ctx.lineTo(700, 100);
            ctx.lineTo(750, 100);
            ctx.lineTo(700, 150);
            ctx.closePath();
            ctx.fill();
            
            ctx.font = '14px Arial';
            ctx.fillStyle = '#3498db';
            ctx.fillText('Use o botão "Aumentar Pulo" para chegar aqui!', 450, 100);
        }

        // Lida com a entrada do teclado
        function handleInput() {
            if (keys['ArrowRight'] || keys['d']) {
                player.x += player.speed;
                player.facing = 'right';
            }
            if (keys['ArrowLeft'] || keys['a']) {
                player.x -= player.speed;
                player.facing = 'left';
            }
            if ((keys['ArrowUp'] || keys['w'] || keys[' ']) && !player.isJumping) {
                player.yVelocity = -player.getJumpStrength();
                player.isJumping = true;
            }
        }

        // Verifica colisões
        function checkCollisions() {
            let onPlatform = false;
            
            platforms.forEach(platform => {
                if (
                    player.y + player.height > platform.y &&
                    player.y < platform.y + platform.height &&
                    player.x + player.width > platform.x &&
                    player.x < platform.x + platform.width
                ) {
                    // Plataforma normal
                    if (platform.type === 'normal' || platform.type === 'jump') {
                        if (player.y + player.height - player.yVelocity <= platform.y) {
                            player.y = platform.y - player.height;
                            player.yVelocity = 0;
                            player.isJumping = false;
                            onPlatform = true;
                        }
                    }
                    // Plataforma de perigo
                    else if (platform.type === 'hazard') {
                        playerLives--;
                        updateUI();
                        resetPlayer();
                    }
                }
            });
            
            // Se não está em uma plataforma e está caindo, está pulando
            if (!onPlatform && player.yVelocity > 0) {
                player.isJumping = true;
            }
        }

        // Verifica se o jogador alcançou um desafio
        function checkChallenge() {
            const challengePlatform = platforms.find(p => p.type === 'challenge');
            
            if (
                player.y + player.height > challengePlatform.y &&
                player.y < challengePlatform.y + challengePlatform.height &&
                player.x + player.width > challengePlatform.x &&
                player.x < challengePlatform.x + challengePlatform.width &&
                !activeChallenge
            ) {
                activeChallenge = challenges[Math.floor(Math.random() * challenges.length)];
                showChallenge(activeChallenge);
            }
        }

        // Mostra um desafio educativo
        function showChallenge(challenge) {
            gamePaused = true;
            challengeQuestion.textContent = challenge.question;
            
            // Limpa opções anteriores
            challengeOptions.innerHTML = '';
            
            // Adiciona novas opções
            challenge.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <input type="radio" id="option${index}" name="challenge" value="${index}">
                    <label for="option${index}">${option}</label>
                `;
                challengeOptions.appendChild(div);
            });
            
            challengeModal.style.display = 'flex';
        }

        // Verifica se o jogador alcançou o objetivo
        function checkGoal() {
            const goal = platforms[platforms.length - 1];
            
            if (
                player.y + player.height > goal.y &&
                player.y < goal.y + goal.height &&
                player.x + player.width > goal.x &&
                player.x < goal.x + goal.width
            ) {
                goalReached = true;
                victory();
            }
        }

        // Reseta a posição do jogador
        function resetPlayer() {
            player.x = 50;
            player.y = 50;
            player.yVelocity = 0;
        }

        // Atualiza a interface do usuário
        function updateUI() {
            knowledgeCounter.textContent = `${knowledgeCollected}/${totalKnowledge}`;
            livesElement.textContent = playerLives;
            jumpPowerElement.textContent = player.jumpPowerLevel * 5;
        }

        // Atualiza o timer
        function updateTimer() {
            const minutes = Math.floor(gameTime / 60);
            const seconds = gameTime % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Game over
        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2);
            
            ctx.fillStyle = '#ecf0f1';
            ctx.font = '24px Arial';
            ctx.fillText('Pressione "Reiniciar" para jogar novamente', canvas.width / 2, canvas.height / 2 + 50);
        }

        // Vitória
        function victory() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#2ecc71';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Parabéns!', canvas.width / 2, canvas.height / 2 - 30);
            ctx.fillText('Você completou o labirinto!', canvas.width / 2, canvas.height / 2 + 30);
            
            ctx.fillStyle = '#ecf0f1';
            ctx.font = '20px Arial';
            ctx.fillText(`Tempo: ${Math.floor(gameTime / 60)}:${(gameTime % 60).toString().padStart(2, '0')}`, canvas.width / 2, canvas.height / 2 + 80);
            
            ctx.fillStyle = '#3498db';
            ctx.font = '24px Arial';
            ctx.fillText('Pressione "Reiniciar" para jogar novamente', canvas.width / 2, canvas.height / 2 + 130);
        }

        // Event listeners
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        restartBtn.addEventListener('click', () => {
            initGame();
        });

        pauseBtn.addEventListener('click', () => {
            gamePaused = !gamePaused;
            pauseBtn.textContent = gamePaused ? 'Continuar' : 'Pausar';
            if (!gamePaused && gameRunning) {
                requestAnimationFrame(gameLoop);
            }
        });

        increaseJumpBtn.addEventListener('click', () => {
            if (player.increaseJumpPower()) {
                updateUI();
            } else {
                alert("Você já atingiu o nível máximo de pulo!");
            }
        });

        helpBtn.addEventListener('click', () => {
            helpModal.style.display = 'flex';
        });

        closeHelpBtn.addEventListener('click', () => {
            helpModal.style.display = 'none';
        });

        submitAnswerBtn.addEventListener('click', () => {
            const selectedOption = document.querySelector('input[name="challenge"]:checked');
            
            if (selectedOption) {
                const answerIndex = parseInt(selectedOption.value);
                
                if (answerIndex === activeChallenge.answer) {
                    // Resposta correta
                    alert('Resposta correta! Você ganhou uma vida extra!');
                    playerLives++;
                    updateUI();
                } else {
                    // Resposta incorreta
                    alert('Resposta incorreta! Tente novamente mais tarde.');
                }
                
                challengeModal.style.display = 'none';
                gamePaused = false;
                activeChallenge = null;
                requestAnimationFrame(gameLoop);
            } else {
                alert('Por favor, selecione uma resposta.');
            }
        });

        // Inicia o jogo
        initGame();
    </script>
</body>
</html>
